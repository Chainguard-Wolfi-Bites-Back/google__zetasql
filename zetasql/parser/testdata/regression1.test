# Ensure this doesn't crash.
select col1,(exists @{a = b} (select col2 from T2)
from T1
where exists @{a=1} (select col from T3)
--
ERROR: Syntax error: Unexpected keyword FROM [at 2:1]
from T1
^
==

SELECT 
SAFE_CAST(COALESCE(ARRAY<gtype>[CAST("TESTENUM1" AS gtype)]) 
AS ARRAY<gtype>) AS a_1, 
SAFE_CAST(COALESCE(ARRAY<gtype>[CAST("" AS gtype)]) AS ARRAY<gtype>) AS a_2, 
SAFE_CAST(COALESCE(STRUCT<BOOL, ARRAY<gtype>, gtype>(false, 
ARRAY<gtype>[CAST("" AS gtype)], CAST("TESTENUM1" AS gtype))) AS STRUCT<BOOL, ARRAY<gtype>, gtype>) 
--
QueryStatement [0-334] [SELECT  SAFE_CAST...>, gtype>)]
  Query [0-334] [SELECT  SAFE_CAST...>, gtype>)]
    Select [0-334] [SELECT  SAFE_CAST...>, gtype>)]
      SelectList [8-334] [SAFE_CAST(...>, gtype>)]
        SelectColumn [8-93] [SAFE_CAST(...gtype>) AS a_1]
          CastExpression(return_null_on_error=true) [8-86] [SAFE_CAST(...ARRAY<gtype>)]
            FunctionCall [18-68] [COALESCE(ARRAY...AS gtype)])]
              PathExpression [18-26] [COALESCE]
                Identifier(COALESCE) [18-26] [COALESCE]
              ArrayConstructor [27-67] [ARRAY<gtype...AS gtype)]]
                ArrayType [27-39] [ARRAY<gtype>]
                  SimpleType [33-38] [gtype]
                    PathExpression [33-38] [gtype]
                      Identifier(gtype) [33-38] [gtype]
                CastExpression [40-66] [CAST("TESTENUM1" AS gtype)]
                  StringLiteral("TESTENUM1") [45-56] ["TESTENUM1"]
                  SimpleType [60-65] [gtype]
                    PathExpression [60-65] [gtype]
                      Identifier(gtype) [60-65] [gtype]
            ArrayType [73-85] [ARRAY<gtype>]
              SimpleType [79-84] [gtype]
                PathExpression [79-84] [gtype]
                  Identifier(gtype) [79-84] [gtype]
          Alias [87-93] [AS a_1]
            Identifier(a_1) [90-93] [a_1]
        SelectColumn [96-171] [SAFE_CAST(...gtype>) AS a_2]
          CastExpression(return_null_on_error=true) [96-164] [SAFE_CAST(...ARRAY<gtype>)]
            FunctionCall [106-147] [COALESCE(ARRAY...AS gtype)])]
              PathExpression [106-114] [COALESCE]
                Identifier(COALESCE) [106-114] [COALESCE]
              ArrayConstructor [115-146] [ARRAY<gtype...AS gtype)]]
                ArrayType [115-127] [ARRAY<gtype>]
                  SimpleType [121-126] [gtype]
                    PathExpression [121-126] [gtype]
                      Identifier(gtype) [121-126] [gtype]
                CastExpression [128-145] [CAST("" AS gtype)]
                  StringLiteral("") [133-135] [""]
                  SimpleType [139-144] [gtype]
                    PathExpression [139-144] [gtype]
                      Identifier(gtype) [139-144] [gtype]
            ArrayType [151-163] [ARRAY<gtype>]
              SimpleType [157-162] [gtype]
                PathExpression [157-162] [gtype]
                  Identifier(gtype) [157-162] [gtype]
          Alias [165-171] [AS a_2]
            Identifier(a_2) [168-171] [a_2]
        SelectColumn [174-334] [SAFE_CAST(...>, gtype>)]
          CastExpression(return_null_on_error=true) [174-334] [SAFE_CAST(...>, gtype>)]
            FunctionCall [184-296] [COALESCE(STRUCT...AS gtype)))]
              PathExpression [184-192] [COALESCE]
                Identifier(COALESCE) [184-192] [COALESCE]
              StructConstructorWithKeyword [193-295] [STRUCT<BOOL...AS gtype))]
                StructType [193-226] [STRUCT<BOOL...gtype>, gtype>]
                  StructField [200-204] [BOOL]
                    SimpleType [200-204] [BOOL]
                      PathExpression [200-204] [BOOL]
                        Identifier(BOOL) [200-204] [BOOL]
                  StructField [206-218] [ARRAY<gtype>]
                    ArrayType [206-218] [ARRAY<gtype>]
                      SimpleType [212-217] [gtype]
                        PathExpression [212-217] [gtype]
                          Identifier(gtype) [212-217] [gtype]
                  StructField [220-225] [gtype]
                    SimpleType [220-225] [gtype]
                      PathExpression [220-225] [gtype]
                        Identifier(gtype) [220-225] [gtype]
                StructConstructorArg [227-232] [false]
                  BooleanLiteral(false) [227-232] [false]
                StructConstructorArg [235-266] [ARRAY<gtype...AS gtype)]]
                  ArrayConstructor [235-266] [ARRAY<gtype...AS gtype)]]
                    ArrayType [235-247] [ARRAY<gtype>]
                      SimpleType [241-246] [gtype]
                        PathExpression [241-246] [gtype]
                          Identifier(gtype) [241-246] [gtype]
                    CastExpression [248-265] [CAST("" AS gtype)]
                      StringLiteral("") [253-255] [""]
                      SimpleType [259-264] [gtype]
                        PathExpression [259-264] [gtype]
                          Identifier(gtype) [259-264] [gtype]
                StructConstructorArg [268-294] [CAST("TESTENUM1" AS gtype)]
                  CastExpression [268-294] [CAST("TESTENUM1" AS gtype)]
                    StringLiteral("TESTENUM1") [273-284] ["TESTENUM1"]
                    SimpleType [288-293] [gtype]
                      PathExpression [288-293] [gtype]
                        Identifier(gtype) [288-293] [gtype]
            StructType [300-333] [STRUCT<BOOL...gtype>, gtype>]
              StructField [307-311] [BOOL]
                SimpleType [307-311] [BOOL]
                  PathExpression [307-311] [BOOL]
                    Identifier(BOOL) [307-311] [BOOL]
              StructField [313-325] [ARRAY<gtype>]
                ArrayType [313-325] [ARRAY<gtype>]
                  SimpleType [319-324] [gtype]
                    PathExpression [319-324] [gtype]
                      Identifier(gtype) [319-324] [gtype]
              StructField [327-332] [gtype]
                SimpleType [327-332] [gtype]
                  PathExpression [327-332] [gtype]
                    Identifier(gtype) [327-332] [gtype]
--
SELECT
  SAFE_CAST(COALESCE(ARRAY< gtype >[CAST("TESTENUM1" AS gtype)]) AS ARRAY< gtype >) AS a_1,
  SAFE_CAST(COALESCE(ARRAY< gtype >[CAST("" AS gtype)]) AS ARRAY< gtype >) AS a_2,
  SAFE_CAST(COALESCE(STRUCT< BOOL, ARRAY< gtype >, gtype > (false, ARRAY< gtype >[CAST("" AS gtype)], CAST("TESTENUM1" AS gtype))) AS STRUCT<
  BOOL, ARRAY< gtype >, gtype >)
==

SELECT SAFE_CAST(COALESCE(ARRAY<`zetasql_test__.TestEnum`>[CAST("TESTENUM1" AS `zetasql_test__.TestEnum`)]) AS ARRAY<`zetasql_test__.TestEnum`>) AS a_1, SAFE_CAST(COALESCE(ARRAY<`zetasql_test__.TestExtraPB`>[CAST("" AS `zetasql_test__.TestExtraPB`)]) AS ARRAY<`zetasql_test__.TestExtraPB`>) AS a_2, SAFE_CAST(COALESCE(STRUCT<BOOL, ARRAY<`zetasql_test__.TestExtraPB`>, `zetasql_test__.TestEnum`>(false, ARRAY<`zetasql_test__.TestExtraPB`>[CAST("" AS `zetasql_test__.TestExtraPB`)], CAST("TESTENUM1" AS `zetasql_test__.TestEnum`))) AS STRUCT<BOOL, ARRAY<`zetasql_test__.TestExtraPB`>, `zetasql_test__.TestEnum`>) AS a_3
--
QueryStatement [0-617] [SELECT SAFE_CAST...`>) AS a_3]
  Query [0-617] [SELECT SAFE_CAST...`>) AS a_3]
    Select [0-617] [SELECT SAFE_CAST...`>) AS a_3]
      SelectList [7-617] [SAFE_CAST(...`>) AS a_3]
        SelectColumn [7-151] [SAFE_CAST(...`>) AS a_1]
          CastExpression(return_null_on_error=true) [7-144] [SAFE_CAST(...TestEnum`>)]
            FunctionCall [17-107] [COALESCE(ARRAY...TestEnum`)])]
              PathExpression [17-25] [COALESCE]
                Identifier(COALESCE) [17-25] [COALESCE]
              ArrayConstructor [26-106] [ARRAY<`zetasql_...estEnum`)]]
                ArrayType [26-58] [ARRAY<`zetasql_...TestEnum`>]
                  SimpleType [32-57] [`zetasql_test__.TestEnum`]
                    PathExpression [32-57] [`zetasql_test__.TestEnum`]
                      Identifier(`zetasql_test__.TestEnum`) [32-57] [`zetasql_test__.TestEnum`]
                CastExpression [59-105] [CAST("TESTENUM1...TestEnum`)]
                  StringLiteral("TESTENUM1") [64-75] ["TESTENUM1"]
                  SimpleType [79-104] [`zetasql_test__.TestEnum`]
                    PathExpression [79-104] [`zetasql_test__.TestEnum`]
                      Identifier(`zetasql_test__.TestEnum`) [79-104] [`zetasql_test__.TestEnum`]
            ArrayType [111-143] [ARRAY<`zetasql_...TestEnum`>]
              SimpleType [117-142] [`zetasql_test__.TestEnum`]
                PathExpression [117-142] [`zetasql_test__.TestEnum`]
                  Identifier(`zetasql_test__.TestEnum`) [117-142] [`zetasql_test__.TestEnum`]
          Alias [145-151] [AS a_1]
            Identifier(a_1) [148-151] [a_1]
        SelectColumn [153-297] [SAFE_CAST(...`>) AS a_2]
          CastExpression(return_null_on_error=true) [153-290] [SAFE_CAST(...TestExtraPB`>)]
            FunctionCall [163-250] [COALESCE(ARRAY...stExtraPB`)])]
              PathExpression [163-171] [COALESCE]
                Identifier(COALESCE) [163-171] [COALESCE]
              ArrayConstructor [172-249] [ARRAY<`zetasql_...ExtraPB`)]]
                ArrayType [172-207] [ARRAY<`zetasql_...tExtraPB`>]
                  SimpleType [178-206] [`zetasql_test__.TestExtraPB`]
                    PathExpression [178-206] [`zetasql_test__.TestExtraPB`]
                      Identifier(`zetasql_test__.TestExtraPB`) [178-206] [`zetasql_test__.TestExtraPB`]
                CastExpression [208-248] [CAST("" AS...TestExtraPB`)]
                  StringLiteral("") [213-215] [""]
                  SimpleType [219-247] [`zetasql_test__.TestExtraPB`]
                    PathExpression [219-247] [`zetasql_test__.TestExtraPB`]
                      Identifier(`zetasql_test__.TestExtraPB`) [219-247] [`zetasql_test__.TestExtraPB`]
            ArrayType [254-289] [ARRAY<`zetasql_...tExtraPB`>]
              SimpleType [260-288] [`zetasql_test__.TestExtraPB`]
                PathExpression [260-288] [`zetasql_test__.TestExtraPB`]
                  Identifier(`zetasql_test__.TestExtraPB`) [260-288] [`zetasql_test__.TestExtraPB`]
          Alias [291-297] [AS a_2]
            Identifier(a_2) [294-297] [a_2]
        SelectColumn [299-617] [SAFE_CAST(...`>) AS a_3]
          CastExpression(return_null_on_error=true) [299-610] [SAFE_CAST(...TestEnum`>)]
            FunctionCall [309-529] [COALESCE(STRUCT...TestEnum`)))]
              PathExpression [309-317] [COALESCE]
                Identifier(COALESCE) [309-317] [COALESCE]
              StructConstructorWithKeyword [318-528] [STRUCT<BOOL...TestEnum`))]
                StructType [318-394] [STRUCT<BOOL...TestEnum`>]
                  StructField [325-329] [BOOL]
                    SimpleType [325-329] [BOOL]
                      PathExpression [325-329] [BOOL]
                        Identifier(BOOL) [325-329] [BOOL]
                  StructField [331-366] [ARRAY<`zetasql_...tExtraPB`>]
                    ArrayType [331-366] [ARRAY<`zetasql_...tExtraPB`>]
                      SimpleType [337-365] [`zetasql_test__.TestExtraPB`]
                        PathExpression [337-365] [`zetasql_test__.TestExtraPB`]
                          Identifier(`zetasql_test__.TestExtraPB`) [337-365] [`zetasql_test__.TestExtraPB`]
                  StructField [368-393] [`zetasql_test__.TestEnum`]
                    SimpleType [368-393] [`zetasql_test__.TestEnum`]
                      PathExpression [368-393] [`zetasql_test__.TestEnum`]
                        Identifier(`zetasql_test__.TestEnum`) [368-393] [`zetasql_test__.TestEnum`]
                StructConstructorArg [395-400] [false]
                  BooleanLiteral(false) [395-400] [false]
                StructConstructorArg [402-479] [ARRAY<`zetasql_...ExtraPB`)]]
                  ArrayConstructor [402-479] [ARRAY<`zetasql_...ExtraPB`)]]
                    ArrayType [402-437] [ARRAY<`zetasql_...tExtraPB`>]
                      SimpleType [408-436] [`zetasql_test__.TestExtraPB`]
                        PathExpression [408-436] [`zetasql_test__.TestExtraPB`]
                          Identifier(`zetasql_test__.TestExtraPB`) [408-436] [`zetasql_test__.TestExtraPB`]
                    CastExpression [438-478] [CAST("" AS...TestExtraPB`)]
                      StringLiteral("") [443-445] [""]
                      SimpleType [449-477] [`zetasql_test__.TestExtraPB`]
                        PathExpression [449-477] [`zetasql_test__.TestExtraPB`]
                          Identifier(`zetasql_test__.TestExtraPB`) [449-477] [`zetasql_test__.TestExtraPB`]
                StructConstructorArg [481-527] [CAST("TESTENUM1...TestEnum`)]
                  CastExpression [481-527] [CAST("TESTENUM1...TestEnum`)]
                    StringLiteral("TESTENUM1") [486-497] ["TESTENUM1"]
                    SimpleType [501-526] [`zetasql_test__.TestEnum`]
                      PathExpression [501-526] [`zetasql_test__.TestEnum`]
                        Identifier(`zetasql_test__.TestEnum`) [501-526] [`zetasql_test__.TestEnum`]
            StructType [533-609] [STRUCT<BOOL...TestEnum`>]
              StructField [540-544] [BOOL]
                SimpleType [540-544] [BOOL]
                  PathExpression [540-544] [BOOL]
                    Identifier(BOOL) [540-544] [BOOL]
              StructField [546-581] [ARRAY<`zetasql_...tExtraPB`>]
                ArrayType [546-581] [ARRAY<`zetasql_...tExtraPB`>]
                  SimpleType [552-580] [`zetasql_test__.TestExtraPB`]
                    PathExpression [552-580] [`zetasql_test__.TestExtraPB`]
                      Identifier(`zetasql_test__.TestExtraPB`) [552-580] [`zetasql_test__.TestExtraPB`]
              StructField [583-608] [`zetasql_test__.TestEnum`]
                SimpleType [583-608] [`zetasql_test__.TestEnum`]
                  PathExpression [583-608] [`zetasql_test__.TestEnum`]
                    Identifier(`zetasql_test__.TestEnum`) [583-608] [`zetasql_test__.TestEnum`]
          Alias [611-617] [AS a_3]
            Identifier(a_3) [614-617] [a_3]
--
SELECT
  SAFE_CAST(COALESCE(ARRAY< `zetasql_test__.TestEnum` >[CAST("TESTENUM1" AS `zetasql_test__.TestEnum`)]) AS ARRAY<
  `zetasql_test__.TestEnum` >) AS a_1,
  SAFE_CAST(COALESCE(ARRAY< `zetasql_test__.TestExtraPB` >[CAST("" AS `zetasql_test__.TestExtraPB`)]) AS ARRAY<
  `zetasql_test__.TestExtraPB` >) AS a_2,
  SAFE_CAST(COALESCE(STRUCT< BOOL, ARRAY< `zetasql_test__.TestExtraPB` >, `zetasql_test__.TestEnum` > (false,
      ARRAY< `zetasql_test__.TestExtraPB` >[CAST("" AS `zetasql_test__.TestExtraPB`)], CAST("TESTENUM1" AS `zetasql_test__.TestEnum`))) AS STRUCT<
  BOOL, ARRAY< `zetasql_test__.TestExtraPB` >, `zetasql_test__.TestEnum` >) AS a_3
